# Описание

После того, как я прочитал задание, я начал думать о том, как бы этот таск мог использоваться на настоящем проекте. Так как нам необходимо общее хранилище данных, я решил остановиться на MongoDB. 

Здесь мы будем хранить объекты двух типов: 

* Объект, в котором находится информация о параметрах проверки (n,k). Его достаточно добавить в таблицу 1 раз, а дальше мы можем перезаписывать в нем n и k;

* Объект, в котором хранится информация о последних проверках, а именно userId и время запуска проверки.

```
[
  {
    _id: ObjectId('660163d5a2e97bef94ba4205'),
    title: 'param',
    n: Long('2'),
    k: Long('1711367224')
  },
  {
    _id: ObjectId('660163d5a2e97bef94ba4206'),
    id: Long('123123'),
    time: Long('1711367125')
  }
]
```

Для этих задач прекрасно подходит MongoDB, быстрый поиск нужных объектов и компактность позволяют работать нескольким экземплярам приложения одновременно. Как пример в Redis нам будет проблематично хранить все данные о вызове метода Check. А в Postgres у нас остануться пустые поля.

Далее я думал о том, чтобы этим приложением без проблем могло пользоваться большое количество пользователей, поэтому базу данных на данном этапе мы поднимаем локально, но в дальнейшем с использованием Docker нам не составит труда масштабировать систему. 

Также удобно бы было один раз поднять сервер и в нужный момент посылать на него запросы.

Проект разбит на 3 слоя:

* handler - обработчик API;
* repository - работа с данными;
* service - бизнес-логика


# Установка и запуск приложения

Клонирование репозитория

```bash
  git clone https://github.com/Rpqshka/flood-control-task.git

  cd flood-control-task
```

Установка MongoDB

```bash
  docker run -d --name mongo-flood -p 27017:27017 mongo
```

Запуск приложения

```bash
  go run .\cmd\main.go
```
## Usage/Examples

1. Метод Check (POST)
```
localhost:8000/check 
```
---

TEST INPUT:
```
{
    "id": "123123"
}
```

TEST OUTPUT:

* Успешный кейс
```
{
    "result": true
}
```

```
{
    _id: ObjectId('660192c0a1c9fab85bd0d4f7'),
    id: Long('123123'),
    time: Long('1711379136')
  }
```


* Неудачный кейс (флуд)
```
{
    "message": "stop flood. try again later. change n or k values"
}
```

---

TEST INPUT:
```
{
    "id": "-123123"
}
```
TEST OUTPUT:
```
{
    "message": "invalid userId value"
}
```
---

2. Установка параметров n и k (POST)
```
localhost:8000/set-param
```

---

* Успешный кейс
TEST INPUT:
```
{
    "n":"5",
    "k": "15"
}
```

TEST OUTPUT:
```
{
    "result": true
}
```

```
{
    _id: ObjectId('66018a9ba6f8c7a31da9df8d'),
    n: Long('5'),
    k: Long('15'),
    title: 'param'
}
```

---

* Неудачный кейс
TEST INPUT:
```
{
    "n":"-5",
    "k": "15"
}
```

TEST OUTPUT:
```
{
    "message": "invalid param n"
}
```
## Контакты

Telegram : @rpqshka

email: rpqshka@gmail.com

